
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mdh.cli &#8212; mdh 1.0.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for mdh.cli</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">MDH command-line interface</span>

<span class="sd">Usage:</span>
<span class="sd">    mdh -h | --help</span>
<span class="sd">    mdh --version</span>
<span class="sd">    mdh download &lt;database_names&gt; &lt;working_directory&gt;</span>
<span class="sd">    mdh standardize &lt;database_names&gt; &lt;working_directory&gt;</span>
<span class="sd">    mdh aromatize &lt;database_names&gt; &lt;working_directory&gt; &lt;save_file&gt; [--aromatic_manager=&lt;aromatic_manager_file&gt;]</span>
<span class="sd">    mdh initialize_compound &lt;database_names&gt; &lt;working_directory&gt; &lt;aromatic_manager_file&gt; [--parse_kegg_atom]</span>
<span class="sd">    mdh initialize_reaction &lt;database_names&gt; &lt;working_directory&gt;</span>
<span class="sd">    mdh harmonize &lt;database_names&gt; &lt;working_directory&gt;</span>
<span class="sd">    mdh test4 &lt;database_names&gt; &lt;working_directory&gt;</span>
<span class="sd">    mdh test7 &lt;k&gt;</span>
<span class="sd">    mdh test1</span>
<span class="sd">    </span>

<span class="sd">Options:</span>
<span class="sd">    -h, --help          Show this screen.</span>
<span class="sd">    --version           Show version.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">KEGG_database_scraper</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">KEGG_parser</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">MetaCyc_parser</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">aromatics</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">tools</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">compound</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">openbabel_utils</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">harmonization</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">faulthandler</span>
<span class="n">faulthandler</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>


<span class="n">scraper_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;KEGG&quot;</span><span class="p">:</span> <span class="n">KEGG_database_scraper</span><span class="p">}</span>
<span class="n">parser_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;KEGG&quot;</span><span class="p">:</span> <span class="n">KEGG_parser</span><span class="p">,</span> <span class="s2">&quot;MetaCyc&quot;</span><span class="p">:</span> <span class="n">MetaCyc_parser</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">construct_compound_via_molfile</span><span class="p">(</span><span class="n">molfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">compound</span><span class="o">.</span><span class="n">Compound</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To construct compound based on the molfile representation.</span>
<span class="sd">    :param molfile: the molfile representation of the compound</span>
<span class="sd">    :return: the :class:`~mdh.compound.Compound` entity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">molfile</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">compound</span><span class="o">.</span><span class="n">Compound</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">molfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">construct_compound_via_kcf</span><span class="p">(</span><span class="n">file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">compound</span><span class="o">.</span><span class="n">Compound</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To construct compound based on the kcf representation.</span>
<span class="sd">    :param file: the kcf representation of the compound.</span>
<span class="sd">    :return: the :class:`~mdh.compound.Compound` entity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">parser_dict</span><span class="p">[</span><span class="s1">&#39;KEGG&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_compound_kcf</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">construct_compound_via_components</span><span class="p">(</span><span class="n">compound_components</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">compound</span><span class="o">.</span><span class="n">Compound</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To construct compound based on the compound components.</span>
<span class="sd">    :param compound_components:</span>
<span class="sd">    :return: the :class:`~mdh.compound.Compound` entity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">this_compound</span> <span class="o">=</span> <span class="n">compound</span><span class="o">.</span><span class="n">Compound</span><span class="p">(</span><span class="n">compound_components</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">compound_components</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">compound_components</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">this_compound</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">this_compound</span>


<span class="k">def</span> <span class="nf">compound_construct_all</span><span class="p">(</span><span class="n">entities</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param entities:</span>
<span class="sd">    :param function:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">compounds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
        <span class="n">this_compound</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">this_compound</span><span class="p">:</span>
            <span class="n">compounds</span><span class="p">[</span><span class="n">this_compound</span><span class="o">.</span><span class="n">compound_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_compound</span>
    <span class="k">return</span> <span class="n">compounds</span>


<span class="k">def</span> <span class="nf">compound_construct_multiprocess</span><span class="p">(</span><span class="n">entities</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To construct compounds with multiprocessing.</span>
<span class="sd">    :param entities: the list of entities used for constructing compounds.</span>
<span class="sd">    :param function: the function used to construct compounds.</span>
<span class="sd">    :return: the dict of compounds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">entities</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">cpd</span><span class="o">.</span><span class="n">compound_name</span><span class="p">:</span> <span class="n">cpd</span> <span class="k">for</span> <span class="n">cpd</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">cpd</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">atom_order_check</span><span class="p">(</span><span class="n">compound_dict1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">compound_dict2</span><span class="p">:</span><span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Here, we want to check if the order of the heavy atoms in the KEGG molfile and kcf representations is the same.</span>
<span class="sd">    Quality check.</span>
<span class="sd">    :param compound_dict1: one dict of compounds</span>
<span class="sd">    :param compound_dict2: the other dict of compounds.</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># the compound name for kcf compound does not contain &quot;cpd:&quot;.</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">compound_name</span> <span class="ow">in</span> <span class="n">compound_dict1</span><span class="p">:</span>
        <span class="n">compound1</span> <span class="o">=</span> <span class="n">compound_dict1</span><span class="p">[</span><span class="n">compound_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">compound_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compound_dict2</span> <span class="ow">and</span> <span class="s2">&quot;cpd:&quot;</span><span class="o">+</span><span class="n">compound_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compound_dict2</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">compound2</span> <span class="o">=</span> <span class="n">compound_dict2</span><span class="p">[</span><span class="n">compound_name</span><span class="p">]</span> <span class="k">if</span> <span class="n">compound_name</span> <span class="ow">in</span> <span class="n">compound_dict2</span> <span class="k">else</span> \
            <span class="n">compound_dict2</span><span class="p">[</span><span class="s2">&quot;cpd:&quot;</span><span class="o">+</span><span class="n">compound_name</span><span class="p">]</span>
        <span class="n">atoms1</span><span class="p">,</span> <span class="n">atoms2</span> <span class="o">=</span> <span class="n">compound1</span><span class="o">.</span><span class="n">heavy_atoms</span><span class="p">,</span> <span class="n">compound2</span><span class="o">.</span><span class="n">heavy_atoms</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms1</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms2</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">atom1</span><span class="p">,</span> <span class="n">atom2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">atoms1</span><span class="p">,</span> <span class="n">atoms2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">atom1</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">x</span> <span class="ow">or</span> <span class="n">atom1</span><span class="o">.</span><span class="n">y</span> <span class="o">!=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">y</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> file has changed!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compound_name</span><span class="p">))</span>
                <span class="k">break</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">KEGG_atom_mapping_correction</span><span class="p">(</span><span class="n">atom_index_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">atom_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The corrected atom mappings between KEGG compounds composed of molfile representations.</span>
<span class="sd">    :param atom_index_mappings: the dict of atom index mappings between kcf and molfile representations.</span>
<span class="sd">    :param atom_mappings: the dict of atom mappings between compounds derived from kcf representations.</span>
<span class="sd">    :return: the dict of atom mappings corrected for molfile representations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_atom_mappings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">atom_mappings</span><span class="p">:</span>
        <span class="n">rlcass</span><span class="p">,</span> <span class="n">cpd1</span><span class="p">,</span> <span class="n">cpd2</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cpd1</span> <span class="ow">in</span> <span class="n">atom_index_mappings</span> <span class="ow">and</span> <span class="n">cpd2</span> <span class="ow">in</span> <span class="n">atom_index_mappings</span><span class="p">:</span>
            <span class="n">this_mapping</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">atom_mappings</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                <span class="p">(</span><span class="n">from_cpd</span><span class="p">,</span> <span class="n">from_idx</span><span class="p">),</span> <span class="p">(</span><span class="n">to_cpd</span><span class="p">,</span> <span class="n">to_idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">entry</span>
                <span class="n">this_mapping</span><span class="o">.</span><span class="n">append</span><span class="p">(((</span><span class="n">from_cpd</span><span class="p">,</span> <span class="n">atom_index_mappings</span><span class="p">[</span><span class="n">from_cpd</span><span class="p">][</span><span class="n">from_idx</span><span class="p">]),</span>
                                     <span class="p">(</span><span class="n">to_cpd</span><span class="p">,</span> <span class="n">atom_index_mappings</span><span class="p">[</span><span class="n">to_cpd</span><span class="p">][</span><span class="n">to_idx</span><span class="p">])))</span>
            <span class="n">new_atom_mappings</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_mapping</span>
    <span class="k">return</span> <span class="n">new_atom_mappings</span>


<span class="k">def</span> <span class="nf">KEGG_atom_index_mapping</span><span class="p">(</span><span class="n">kcf_compounds</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">mol_compounds</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To map the atom index between kcf and molfile representations for KEGG compounds.</span>
<span class="sd">    :param kcf_compounds: the dict of compounds composed of kcf representations.</span>
<span class="sd">    :param mol_compounds:the dict of compounds composed of molfile representations.</span>
<span class="sd">    :return: the dict of atom index mappings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">atom_index_mappings</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">cpd_name</span> <span class="ow">in</span> <span class="n">kcf_compounds</span><span class="p">:</span>
        <span class="n">kcf_cpd</span> <span class="o">=</span> <span class="n">kcf_compounds</span><span class="p">[</span><span class="n">cpd_name</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;cpd:&quot;</span> <span class="o">+</span> <span class="n">cpd_name</span> <span class="ow">in</span> <span class="n">mol_compounds</span><span class="p">:</span>
            <span class="n">mol_cpd</span> <span class="o">=</span> <span class="n">mol_compounds</span><span class="p">[</span><span class="s2">&quot;cpd:&quot;</span> <span class="o">+</span> <span class="n">cpd_name</span><span class="p">]</span>
            <span class="n">mappings</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">kcf_cpd</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
                <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol_cpd</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">kcf_cpd</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="n">mol_cpd</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="ow">or</span>
                                                  <span class="n">kcf_cpd</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">!=</span> <span class="n">mol_cpd</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">):</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">mappings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">kcf_cpd</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KEGG atom index mappings for compound </span><span class="si">{0}</span><span class="s2"> are not complete!!!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cpd_name</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">atom_index_mappings</span><span class="p">[</span><span class="n">cpd_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mappings</span>
    <span class="k">return</span> <span class="n">atom_index_mappings</span>


<span class="k">def</span> <span class="nf">parse_reactions</span><span class="p">(</span><span class="n">compounds</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">reactions</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    To parse the reaction by linking to the compound entities.</span>
<span class="sd">    :param compounds: the dict of compound entities.</span>
<span class="sd">    :param reactions: the list of reaction entities.</span>
<span class="sd">    :return: the list of reaction entities.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">reaction</span> <span class="ow">in</span> <span class="n">reactions</span><span class="p">:</span>
        <span class="n">reaction</span><span class="o">.</span><span class="n">one_side</span> <span class="o">=</span> <span class="p">[</span><span class="n">compounds</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">reaction</span><span class="o">.</span><span class="n">one_side</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">compounds</span><span class="p">]</span>
        <span class="n">reaction</span><span class="o">.</span><span class="n">the_other_side</span> <span class="o">=</span> <span class="p">[</span><span class="n">compounds</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">reaction</span><span class="o">.</span><span class="n">the_other_side</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">compounds</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">reactions</span>


<div class="viewcode-block" id="cli"><a class="viewcode-back" href="../../api.html#mdh.cli.cli">[docs]</a><span class="k">def</span> <span class="nf">cli</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;download&#39;</span><span class="p">]:</span>
        <span class="n">database_names</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_names&gt;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">working_directory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;working_directory&gt;&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">database_name</span> <span class="ow">in</span> <span class="n">database_names</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/sources&quot;</span><span class="p">,</span> <span class="n">database_name</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">scraper_dict</span><span class="p">[</span><span class="n">database_name</span><span class="p">]</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Scraper for </span><span class="si">{0}</span><span class="s2"> database does not exits&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;standardize&#39;</span><span class="p">]:</span>
        <span class="c1"># here to search the database directory, find the molfile subdirectory and create standardized_molfile</span>
        <span class="c1"># subdirectory and store the standardized molfile in it.</span>
        <span class="n">database_names</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_names&gt;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">working_directory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;working_directory&gt;&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">database_name</span> <span class="ow">in</span> <span class="n">database_names</span><span class="p">:</span>
            <span class="n">from_path</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;sources/</span><span class="si">{0}</span><span class="s2">/molfile&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The directory </span><span class="si">{0}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_path</span><span class="p">))</span>
            <span class="n">to_path</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/standardized/</span><span class="si">{0}</span><span class="s2">/molfile&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">to_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">molfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">from_path</span> <span class="o">+</span> <span class="s2">&quot;/*&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">molfile</span> <span class="ow">in</span> <span class="n">molfiles</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">molfile</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">openbabel_utils</span><span class="o">.</span><span class="n">standardize_molfile</span><span class="p">(</span><span class="n">molfile</span><span class="p">,</span> <span class="n">to_path</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;aromatize&#39;</span><span class="p">]:</span>
        <span class="n">database_names</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_names&gt;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">working_directory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;working_directory&gt;&#39;</span><span class="p">]</span>
        <span class="n">save_file</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;save_file&gt;&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--aromatic_manager&#39;</span><span class="p">]:</span>
            <span class="n">aromatic_manager</span> <span class="o">=</span> <span class="n">aromatics</span><span class="o">.</span><span class="n">AromaticManager</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">open_jsonpickle</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;--aromatic_manager&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aromatic_manager</span> <span class="o">=</span> <span class="n">aromatics</span><span class="o">.</span><span class="n">AromaticManager</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">database_name</span> <span class="ow">in</span> <span class="n">database_names</span><span class="p">:</span>
            <span class="n">from_path</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;standardized/</span><span class="si">{0}</span><span class="s2">/molfile&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The directory </span><span class="si">{0}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_path</span><span class="p">))</span>
            <span class="n">molfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">from_path</span> <span class="o">+</span> <span class="s2">&quot;/*&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">molfile</span> <span class="ow">in</span> <span class="n">molfiles</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">molfile</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">aromatic_manager</span><span class="o">.</span><span class="n">indigo_aromatize</span><span class="p">(</span><span class="n">molfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;KEGG&quot;</span> <span class="ow">in</span> <span class="n">database_names</span><span class="p">:</span>
            <span class="n">kcf_path</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/sources/KEGG/kcf&quot;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">kcf_path</span><span class="p">):</span>
                <span class="n">kcf_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">kcf_path</span> <span class="o">+</span> <span class="s2">&quot;/*&quot;</span><span class="p">)</span>
                <span class="n">parser</span> <span class="o">=</span> <span class="n">parser_dict</span><span class="p">[</span><span class="s1">&#39;KEGG&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">kcf_file</span> <span class="ow">in</span> <span class="n">kcf_files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">kcf_file</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">kcf_cpd</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">create_compound_kcf</span><span class="p">(</span><span class="n">kcf_file</span><span class="p">)</span>
                        <span class="n">aromatic_manager</span><span class="o">.</span><span class="n">kegg_aromatize</span><span class="p">(</span><span class="n">kcf_cpd</span><span class="p">)</span>
        <span class="n">tools</span><span class="o">.</span><span class="n">save_to_jsonpickle</span><span class="p">(</span><span class="n">aromatic_manager</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">save_file</span><span class="p">)</span>
    
    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;initialize_compound&#39;</span><span class="p">]:</span>
        <span class="n">database_names</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_names&gt;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">working_directory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;working_directory&gt;&#39;</span><span class="p">]</span>
        <span class="n">aromatic_manager</span> <span class="o">=</span> <span class="n">aromatics</span><span class="o">.</span><span class="n">AromaticManager</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">open_jsonpickle</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;aromatic_manager_file&gt;&#39;</span><span class="p">]))</span>
        <span class="n">to_directory</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/initialized&quot;</span>
        <span class="k">for</span> <span class="n">database_name</span> <span class="ow">in</span> <span class="n">database_names</span><span class="p">:</span>
            <span class="n">from_path</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;standardized/</span><span class="si">{0}</span><span class="s2">/molfile&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The directory </span><span class="si">{0}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_path</span><span class="p">))</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">parser_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">database_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># construct compounds</span>
            <span class="n">molfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">from_path</span> <span class="o">+</span> <span class="s2">&quot;/*&quot;</span><span class="p">)</span>
            <span class="n">compound_dict</span> <span class="o">=</span> <span class="n">compound_construct_all</span><span class="p">(</span><span class="n">molfiles</span><span class="p">,</span> <span class="n">construct_compound_via_molfile</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--parse_kegg_atom&#39;</span><span class="p">]:</span>
                <span class="c1"># I choose to parse the kegg atom mapings here, since the kegg atom mappings are only related to</span>
                <span class="c1"># compounds rather than reactions.</span>
                <span class="c1"># sanity check if the atom orders in the kcf file, original molfile and standardized molfile are the</span>
                <span class="c1"># same.</span>
                <span class="c1"># two comparison: kcf - original; original - standardized.</span>
                <span class="c1"># for kcf - original: some molfiles have H atoms but the corresponding kcf files don&#39;t, and these Hs are</span>
                <span class="c1"># in the middle, which can lead to the mess of atom mappings.</span>

                <span class="n">rclass_directory</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/sources/KEGG/rclass/&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">rclass_directory</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The directory </span><span class="si">{0}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rclass_directory</span><span class="p">))</span>
                <span class="c1"># construct KEGG compound via KEGG kcf files. This is used for atom mappings</span>
                <span class="n">kcf_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/sources/KEGG/kcf/*&quot;</span><span class="p">)</span>
                <span class="n">kcf_compounds</span> <span class="o">=</span> <span class="n">compound_construct_all</span><span class="p">(</span><span class="n">kcf_files</span><span class="p">,</span> <span class="n">construct_compound_via_kcf</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;count of original kegg compound files &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">kcf_compounds</span><span class="p">))</span>
                <span class="n">original_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/sources/KEGG/molfile/*&quot;</span><span class="p">)</span>
                <span class="n">original_compounds</span> <span class="o">=</span> <span class="n">compound_construct_all</span><span class="p">(</span><span class="n">original_files</span><span class="p">,</span> <span class="n">construct_compound_via_molfile</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;count of original kegg compound files &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">original_compounds</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;comparison of kcf and original&quot;</span><span class="p">)</span>
                <span class="n">atom_order_check</span><span class="p">(</span><span class="n">kcf_compounds</span><span class="p">,</span> <span class="n">original_compounds</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;comparison of standard and original&quot;</span><span class="p">)</span>
                <span class="n">atom_order_check</span><span class="p">(</span><span class="n">original_compounds</span><span class="p">,</span> <span class="n">compound_dict</span><span class="p">)</span>
                <span class="n">atom_mappings</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">create_atom_mappings</span><span class="p">(</span><span class="n">rclass_directory</span><span class="p">,</span> <span class="n">kcf_compounds</span><span class="p">)</span>
                <span class="c1"># atom_mappings = tools.open_jsonpickle(working_directory + &quot;/kegg_atom_mappings_test.json&quot;)</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">save_to_jsonpickle</span><span class="p">(</span><span class="n">atom_mappings</span><span class="p">,</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/kegg_atom_mappings_test_1.json&quot;</span><span class="p">)</span>
                <span class="n">atom_mappings</span> <span class="o">=</span> <span class="n">KEGG_atom_mapping_correction</span><span class="p">(</span><span class="n">KEGG_atom_index_mapping</span><span class="p">(</span><span class="n">kcf_compounds</span><span class="p">,</span> <span class="n">compound_dict</span><span class="p">),</span>
                                                             <span class="n">atom_mappings</span><span class="p">)</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">save_to_jsonpickle</span><span class="p">(</span><span class="n">atom_mappings</span><span class="p">,</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/kegg_atom_mappings_IC_test_1.json&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">cpd_name</span> <span class="ow">in</span> <span class="n">compound_dict</span><span class="p">:</span>
                <span class="n">cpd</span> <span class="o">=</span> <span class="n">compound_dict</span><span class="p">[</span><span class="n">cpd_name</span><span class="p">]</span>
                <span class="c1"># aromatic substructure detection</span>
                <span class="n">aromatic_manager</span><span class="o">.</span><span class="n">detect_aromatic_substructures</span><span class="p">(</span><span class="n">cpd</span><span class="p">)</span>
                <span class="n">cpd</span><span class="o">.</span><span class="n">define_bond_stereochemistry</span><span class="p">()</span>
                <span class="n">cpd</span><span class="o">.</span><span class="n">curate_invalid_n</span><span class="p">()</span>

            <span class="n">save_directory</span> <span class="o">=</span> <span class="n">to_directory</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">save_to_jsonpickle</span><span class="p">({</span><span class="n">name</span><span class="p">:</span> <span class="n">compound_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">compound_dict</span><span class="p">},</span> <span class="n">save_directory</span> <span class="o">+</span>
                                     <span class="s2">&quot;/compounds_test_1.json&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;initialize_reaction&#39;</span><span class="p">]:</span>

        <span class="n">database_names</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_names&gt;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">working_directory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;working_directory&gt;&#39;</span><span class="p">]</span>
        <span class="n">to_directory</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/initialized&quot;</span>

        <span class="k">for</span> <span class="n">database_name</span> <span class="ow">in</span> <span class="n">database_names</span><span class="p">:</span>

            <span class="n">save_directory</span> <span class="o">=</span> <span class="n">to_directory</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_directory</span> <span class="o">+</span> <span class="s2">&quot;/compounds.json&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;Please construct the </span><span class="si">{0}</span><span class="s2"> compounds first!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">))</span>

            <span class="n">compounds</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">open_jsonpickle</span><span class="p">(</span><span class="n">save_directory</span> <span class="o">+</span> <span class="s2">&quot;/compounds.json&quot;</span><span class="p">)</span>
            <span class="n">compound_dict</span> <span class="o">=</span> <span class="n">compound_construct_all</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">compounds</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">construct_compound_via_components</span><span class="p">)</span>

            <span class="n">reaction_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">parser_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">database_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">database_name</span> <span class="o">==</span> <span class="s2">&quot;KEGG&quot;</span><span class="p">:</span>
                <span class="n">reaction_directory</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/sources/KEGG/reaction/&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">reaction_directory</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The directory </span><span class="si">{0}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reaction_directory</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/kegg_atom_mappings_IC.json&quot;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The atom mappings of KEGG compounds have not been generated.&quot;</span><span class="p">)</span>
                <span class="n">atom_mappings</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">open_jsonpickle</span><span class="p">(</span><span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/kegg_atom_mappings_IC.json&quot;</span><span class="p">)</span>
                <span class="n">reaction_list</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">create_reactions</span><span class="p">(</span><span class="n">reaction_directory</span><span class="p">,</span> <span class="n">compound_dict</span><span class="p">,</span> <span class="n">atom_mappings</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">database_name</span> <span class="o">==</span> <span class="s2">&quot;MetaCyc&quot;</span><span class="p">:</span>
                <span class="n">reaction_file</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/sources/MetaCyc/reactions.dat&quot;</span>
                <span class="n">atom_mapping_file</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/sources/MetaCyc/atom-mapping.dat&quot;</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">reaction_file</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">{0}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reaction_file</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">atom_mapping_file</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">{0}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">atom_mapping_file</span><span class="p">))</span>
                <span class="n">reaction_list</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">create_reactions</span><span class="p">(</span><span class="n">reaction_file</span><span class="p">,</span> <span class="n">atom_mapping_file</span><span class="p">,</span> <span class="n">compound_dict</span><span class="p">)</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">save_to_jsonpickle</span><span class="p">(</span><span class="n">reaction_list</span><span class="p">,</span> <span class="n">save_directory</span> <span class="o">+</span> <span class="s2">&quot;/reactions.json&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;harmonize&#39;</span><span class="p">]:</span>
        <span class="c1"># create harmonized compound manager first, then reaction harmonization manager.</span>

        <span class="n">database_names</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_names&gt;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">working_directory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;working_directory&gt;&#39;</span><span class="p">]</span>
        <span class="n">compound_dict</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reaction_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">save_directory</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/harmonized&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">database_name</span> <span class="ow">in</span> <span class="n">database_names</span><span class="p">:</span>
            <span class="n">from_directory</span> <span class="o">=</span> <span class="n">working_directory</span> <span class="o">+</span> <span class="s2">&quot;/initialized/</span><span class="si">{0}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">database_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_directory</span> <span class="o">+</span> <span class="s2">&quot;compounds.json&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">{0}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_directory</span> <span class="o">+</span> <span class="s2">&quot;compounds.json&quot;</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">from_directory</span> <span class="o">+</span> <span class="s2">&quot;reactions.json&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The file </span><span class="si">{0}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">from_directory</span> <span class="o">+</span> <span class="s2">&quot;reactions.json&quot;</span><span class="p">))</span>
            <span class="n">compounds</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">open_jsonpickle</span><span class="p">(</span><span class="n">from_directory</span> <span class="o">+</span> <span class="s2">&quot;compounds.json&quot;</span><span class="p">)</span>
            <span class="n">compound_parsed</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">compounds</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">this_compound</span> <span class="o">=</span> <span class="n">compound</span><span class="o">.</span><span class="n">Compound</span><span class="p">(</span><span class="n">compounds</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">compounds</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">compounds</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">this_compound</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="n">this_compound</span><span class="p">:</span>
                    <span class="n">compound_parsed</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">this_compound</span>
            <span class="n">compound_dict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compound_parsed</span><span class="p">)</span>
            <span class="n">reactions</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">open_jsonpickle</span><span class="p">(</span><span class="n">from_directory</span> <span class="o">+</span> <span class="s2">&quot;reactions.json&quot;</span><span class="p">)</span>
            <span class="n">reaction_parsed</span> <span class="o">=</span> <span class="n">parse_reactions</span><span class="p">(</span><span class="n">compound_parsed</span><span class="p">,</span> <span class="n">reactions</span><span class="p">)</span>
            <span class="n">reaction_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reaction_parsed</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start compound harmonization&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_directory</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">{0}</span><span class="s2">_initial_harmonized_compounds.json&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">database_names</span><span class="p">))):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;we find the initial_harmonized_compounds&quot;</span><span class="p">)</span>
            <span class="n">initial_harmonized_compounds</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">open_jsonpickle</span><span class="p">(</span><span class="n">save_directory</span> <span class="o">+</span>
                                                                 <span class="s2">&quot;/</span><span class="si">{0}</span><span class="s2">_initial_harmonized_compounds.json&quot;</span><span class="o">.</span>
                                                                 <span class="nb">format</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">database_names</span><span class="p">)))</span>
            <span class="n">compound_harmonization_manager</span> <span class="o">=</span> <span class="n">harmonization</span><span class="o">.</span><span class="n">CompoundHarmonizationManager</span><span class="o">.</span>\
                <span class="n">create_manager</span><span class="p">(</span><span class="n">compound_dict</span><span class="p">,</span> <span class="n">initial_harmonized_compounds</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">compound_harmonization_manager</span> <span class="o">=</span> <span class="n">harmonization</span><span class="o">.</span><span class="n">harmonize_compound_list</span><span class="p">(</span><span class="n">compound_dict</span><span class="p">)</span>
            <span class="n">initial_harmonized_compounds</span> <span class="o">=</span> <span class="n">compound_harmonization_manager</span><span class="o">.</span><span class="n">save_manager</span><span class="p">()</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">save_to_jsonpickle</span><span class="p">(</span><span class="n">initial_harmonized_compounds</span><span class="p">,</span> <span class="n">save_directory</span> <span class="o">+</span>
                                     <span class="s2">&quot;/</span><span class="si">{0}</span><span class="s2">_initial_harmonized_compounds.json&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">database_names</span><span class="p">)))</span>
        <span class="c1"># while we do reaction harmonization, we need to pay attention to compound harmonization without same structural</span>
        <span class="c1"># representations.</span>
        <span class="c1"># this includes: R group, linear-circular-transformation, resonance.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start reaction harmonization&quot;</span><span class="p">)</span>
        <span class="n">reaction_harmonization_manager</span> <span class="o">=</span> <span class="n">harmonization</span><span class="o">.</span><span class="n">harmonize_reaction_list</span><span class="p">(</span><span class="n">reaction_list</span><span class="p">,</span>
                                                                               <span class="n">compound_harmonization_manager</span><span class="p">)</span>
        <span class="c1"># let&#39;s just save the list of harmonized names first.</span>
        <span class="n">harmonized_compounds</span> <span class="o">=</span> <span class="n">reaction_harmonization_manager</span><span class="o">.</span><span class="n">compound_harmonization_manager</span><span class="o">.</span><span class="n">save_manager</span><span class="p">()</span>
        <span class="n">harmonized_reactions</span> <span class="o">=</span> <span class="n">reaction_harmonization_manager</span><span class="o">.</span><span class="n">save_manager</span><span class="p">()</span>

        <span class="n">tools</span><span class="o">.</span><span class="n">save_to_jsonpickle</span><span class="p">(</span><span class="n">harmonized_compounds</span><span class="p">,</span> <span class="n">save_directory</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">{0}</span><span class="s2">_harmonized_compounds_0.5.json&quot;</span><span class="o">.</span>
                                 <span class="nb">format</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">database_names</span><span class="p">)))</span>
        <span class="n">tools</span><span class="o">.</span><span class="n">save_to_jsonpickle</span><span class="p">(</span><span class="n">harmonized_reactions</span><span class="p">,</span> <span class="n">save_directory</span> <span class="o">+</span> <span class="s2">&quot;/</span><span class="si">{0}</span><span class="s2">_harmonized_reactions_0.5.json&quot;</span><span class="o">.</span>
                                 <span class="nb">format</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">database_names</span><span class="p">)))</span>

    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;test1&quot;</span><span class="p">]:</span>
        <span class="n">kegg_compound_1_file</span> <span class="o">=</span> <span class="s2">&quot;/mlab/data/hji236/projects/MDH_test/sources/KEGG/kcf/cpd:C05670&quot;</span>
        <span class="n">kegg_compound_2_file</span> <span class="o">=</span> <span class="s2">&quot;/mlab/data/hji236/projects/MDH_test/sources/KEGG/kcf/cpd:C06114&quot;</span>

        <span class="c1"># kegg_compound_1_file = &quot;/mlab/data/hji236/projects/MDH_test/sources/KEGG/kcf/cpd:C01063&quot;</span>
        <span class="c1"># kegg_compound_2_file = &quot;/mlab/data/hji236/projects/MDH_test/sources/KEGG/kcf/cpd:C09813&quot;</span>
        <span class="n">kegg_1</span> <span class="o">=</span> <span class="n">construct_compound_via_kcf</span><span class="p">(</span><span class="n">kegg_compound_1_file</span><span class="p">)</span>
        <span class="n">kegg_2</span> <span class="o">=</span> <span class="n">construct_compound_via_kcf</span><span class="p">(</span><span class="n">kegg_compound_2_file</span><span class="p">)</span>
        <span class="n">compounds</span> <span class="o">=</span> <span class="p">{</span><span class="n">kegg_1</span><span class="o">.</span><span class="n">compound_name</span><span class="p">:</span> <span class="n">kegg_1</span><span class="p">,</span> <span class="n">kegg_2</span><span class="o">.</span><span class="n">compound_name</span><span class="p">:</span> <span class="n">kegg_2</span><span class="p">}</span>
        <span class="n">rclass_dir</span> <span class="o">=</span> <span class="s2">&quot;/mlab/data/hji236/projects/MDH_test/sources/KEGG/rclass_target/&quot;</span>
        <span class="n">atom_mappings</span> <span class="o">=</span> <span class="n">parser_dict</span><span class="p">[</span><span class="s2">&quot;KEGG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">create_atom_mappings</span><span class="p">(</span><span class="n">rclass_dir</span><span class="p">,</span> <span class="n">compounds</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">atom_mappings</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s2">&quot;test4&quot;</span><span class="p">]:</span>
        <span class="n">database_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_names&gt;&#39;</span><span class="p">]</span>
        <span class="n">working_directory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;working_directory&gt;&#39;</span><span class="p">]</span>
        <span class="c1"># from_directory = working_directory + &quot;/initialized/&quot;</span>

        <span class="c1"># r group testing</span>
        <span class="n">kegg_compound_file</span> <span class="o">=</span> <span class="s2">&quot;/scratch/hji236/MDH_test/standardized/KEGG/molfile/cpd:C01371.mol&quot;</span>
        <span class="n">metacyc_compound_file</span> <span class="o">=</span> <span class="s2">&quot;/scratch/hji236/MDH_test/standardized/MetaCyc/molfile/Alkanes.mol&quot;</span>


        <span class="c1">#</span>
        <span class="c1"># kegg_compound_file = &quot;/scratch/hji236/MDH_test/standardized/KEGG/molfile/cpd:C04618.mol&quot;</span>
        <span class="c1"># metacyc_compound_file = &quot;/scratch/hji236/MDH_test/standardized/MetaCyc/molfile/CPD-13230.mol&quot;</span>
        <span class="c1">#</span>
        <span class="n">kegg_compound</span> <span class="o">=</span> <span class="n">construct_compound_via_molfile</span><span class="p">(</span><span class="n">kegg_compound_file</span><span class="p">)</span>
        <span class="n">metacyc_compound</span> <span class="o">=</span> <span class="n">construct_compound_via_molfile</span><span class="p">(</span><span class="n">metacyc_compound_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">kegg_compound</span><span class="o">.</span><span class="n">compound_name</span><span class="p">,</span> <span class="n">metacyc_compound</span><span class="o">.</span><span class="n">compound_name</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># # kegg_compound = kegg_compound_parsed[&quot;cpd:C04618&quot;]</span>
        <span class="c1"># # metacyc_compound = metacyc_compound_parsed[&quot;CPD-13230&quot;]</span>
        <span class="n">relationship</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="n">kegg_compound</span><span class="o">.</span><span class="n">with_r_pair_relationship</span><span class="p">(</span><span class="n">metacyc_compound</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">relationship</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span></div>


        <span class="c1"># resonance testing</span>
        <span class="c1"># kegg_compound_file = &quot;/scratch/hji236/MDH_test/standardized/KEGG/molfile/cpd:C11821.mol&quot;</span>
        <span class="c1"># metacyc_compound_file = &quot;/scratch/hji236/MDH_test/standardized/MetaCyc/molfile/5-HYDROXYISOURATE.mol&quot;</span>
        <span class="c1"># kegg_compound = construct_compound_via_molfile(kegg_compound_file)</span>
        <span class="c1"># metacyc_compound = construct_compound_via_molfile(metacyc_compound_file)</span>
        <span class="c1"># resonant_mappings = kegg_compound.map_resonance(metacyc_compound, r_distance=False)</span>
        <span class="c1"># if resonant_mappings:</span>
        <span class="c1">#     relationship, atom_mappings = kegg_compound.optimal_resonant_mapping(metacyc_compound, resonant_mappings)</span>
        <span class="c1">#     print(atom_mappings)</span>
        <span class="c1">#</span>
        <span class="c1"># # linear circular testing</span>
        <span class="c1"># kegg_compound_file = &quot;/scratch/hji236/MDH_test/standardized/KEGG/molfile/cpd:C05345.mol&quot;</span>
        <span class="c1"># metacyc_compound_file = &quot;/scratch/hji236/MDH_test/standardized/MetaCyc/molfile/CPD-15709.mol&quot;</span>
        <span class="c1"># kegg_compound = construct_compound_via_molfile(kegg_compound_file)</span>
        <span class="c1"># metacyc_compound = construct_compound_via_molfile(metacyc_compound_file)</span>
        <span class="c1"># relationship, atom_mappings = kegg_compound.circular_pair_relationship(metacyc_compound)</span>
        <span class="c1"># print(relationship, atom_mappings)</span>



    <span class="c1"># kegg_compound = construct_compound_via_molfile(kegg_compound_file)</span>
    <span class="c1"># metacyc_compound = construct_compound_via_molfile(metacyc_compound_file)</span>
    <span class="c1"># # compounds = tools.open_jsonpickle(from_directory + &quot;KEGG/compounds.json&quot;)</span>
    <span class="c1"># # kegg_compound_parsed = { name: compound.Compound(compounds[name][0], compounds[name][1], compounds[name][2]) for</span>
    <span class="c1"># #                         name in compounds }</span>
    <span class="c1"># # compounds = tools.open_jsonpickle(from_directory + &quot;MetaCyc/compounds.json&quot;)</span>
    <span class="c1"># # metacyc_compound_parsed = {name: compound.Compound(compounds[name][0], compounds[name][1], compounds[name][2]) for</span>
    <span class="c1"># #                         name in compounds}</span>

    <span class="c1">#     database_names = args[&#39;&lt;database_names&gt;&#39;].split(&quot;,&quot;)</span>
    <span class="c1">#     ks = args[&#39;&lt;ks&gt;&#39;].split(&quot;,&quot;)</span>
    <span class="c1">#     working_directory = args[&#39;&lt;working_directory&gt;&#39;]</span>
    <span class="c1">#     compound_dict = []</span>
    <span class="c1">#     for i, database_name in enumerate(database_names):</span>
    <span class="c1">#         from_directory = working_directory + &quot;/initialized/{0}/&quot;.format(database_name)</span>
    <span class="c1">#         if ks[i] == &quot;*&quot;:</span>
    <span class="c1">#             files = glob.glob(&quot;{0}compounds*.json&quot;.format(from_directory))</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             files = glob.glob(&quot;{0}compounds_{1}.json&quot;.format(from_directory, ks[i]))</span>
    <span class="c1">#         if not files:</span>
    <span class="c1">#             raise OSError(&quot;The file {0} does not exist.&quot;.format(from_directory + &quot;compounds.json&quot;))</span>
    <span class="c1">#         compounds = {}</span>
    <span class="c1">#         for file in files:</span>
    <span class="c1">#             compounds.update(tools.open_jsonpickle(file))</span>
    <span class="c1">#         print(&quot;construct compounds&quot;)</span>
    <span class="c1">#         compounds = compound_construct_multiprocess(list(compounds.values()), construct_cpd_components)</span>
    <span class="c1">#         compound_dict.append(compounds)</span>
    <span class="c1">#         print(&quot;complete compound construction&quot;)</span>
    <span class="c1">#     compound_harmonization_manager = harmonization.harmonize_compound_list(compound_dict)</span>
    <span class="c1">#     save_directory = working_directory + &quot;/harmonized/&quot;</span>
    <span class="c1">#     os.makedirs(save_directory, exist_ok=True)</span>
    <span class="c1">#     tools.save_to_json(compound_harmonization_manager.save_manager(), working_directory +</span>
    <span class="c1">#                        &quot;{0}_{1}.json&quot;.format(&quot;_&quot;.join(database_names), &quot;_&quot;.join(ks)))</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
    <span class="c1"># # construct compounds in MDH, sub group</span>
    <span class="c1"># elif args[&#39;test7&#39;]:</span>
    <span class="c1">#     aromatic_manager_file = &quot;/scratch/hji236/MDH_test/aromatic_manager_1.json&quot;</span>
    <span class="c1">#     aromatic_manager = aromatics.AromaticManager.decode(tools.open_jsonpickle(aromatic_manager_file))</span>
    <span class="c1">#     k = args[&#39;&lt;k&gt;&#39;]</span>
    <span class="c1">#     file_dir = &quot;/scratch/hji236/MDH_test/standardized/HMD/molfile_split/sub_{0}&quot;.format(k)</span>
    <span class="c1">#     to_directory = &quot;/scratch/hji236/MDH_test/initialized/HMD/&quot;</span>
    <span class="c1">#     compound_dict = {}</span>
    <span class="c1">#     molfiles = glob.glob(file_dir + &quot;/*&quot;)</span>
    <span class="c1">#     # compound_dict = compound_construct_multiprocess(molfiles, construct_cpd)</span>
    <span class="c1">#     for file in molfiles:</span>
    <span class="c1">#         print(file)</span>
    <span class="c1">#         compound = construct_cpd(file)</span>
    <span class="c1">#         compound_dict[compound.compound_name] = compound</span>
    <span class="c1">#     for cpd_name in compound_dict:</span>
    <span class="c1">#         cpd = compound_dict[cpd_name]</span>
    <span class="c1">#         # aromatic substructure detection</span>
    <span class="c1">#         print(cpd_name)</span>
    <span class="c1">#         aromatic_manager.detect_aromatic_substructures(cpd)</span>
    <span class="c1">#         cpd.define_bond_stereochemistry()</span>
    <span class="c1">#         cpd.curate_invalid_n()</span>
    <span class="c1">#     tools.save_to_jsonpickle({name: compound_dict[name].encode() for name in compound_dict},</span>
    <span class="c1">#                              to_directory + &quot;/compounds_{0}.json&quot;.format(k))</span>
    <span class="c1">#</span>

    
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">mdh</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">The MDH Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">The MDH API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Huan Jin, Hunter N.B. Moseley.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>